name: release-native-benchmarks

on:
  workflow_dispatch:
    inputs:
      candidate_label:
        description: "Release candidate label (e.g. rc-2026-02-24)"
        required: true
        default: "manual-candidate"
  push:
    tags:
      - "v*"

jobs:
  native-release-candidate-gates:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - uses: Swatinem/rust-cache@v2
      - name: Run alpha release readiness gate
        env:
          TONIC_ALPHA_ARTIFACT_DIR: .tonic/release
        run: ./scripts/release-alpha-readiness.sh
      - name: Upload release benchmark artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: release-native-${{ github.ref_name }}-${{ github.event.inputs.candidate_label || 'tag' }}
          path: .tonic/release/
